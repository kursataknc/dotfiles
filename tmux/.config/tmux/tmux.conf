# ==========================================
# GENERAL SETTINGS
# ==========================================
source-file ~/.config/tmux/tmux.reset.conf

set -g mouse on                  # Enable mouse support
set -g prefix ^A                 # Set prefix key to Ctrl+A
set -g base-index 1              # Start indexing windows at 1 instead of 0
set -g detach-on-destroy off     # Don't exit from tmux when closing a session
set -g escape-time 0             # Zero-out escape time delay
set -g history-limit 1000000     # Increase history size (from 2,000)
set -g renumber-windows on       # Renumber all windows when any window is closed
set -g set-clipboard on          # Use system clipboard
set -g status-position top       # Position status bar at the top (macOS style)
setw -g mode-keys vi             # Use vi keybindings in copy mode

# Terminal settings
set-option -g default-terminal 'tmux-256color'
set-option -g terminal-overrides ',xterm-256color:RGB'
set-option -g default-shell /opt/homebrew/bin/nu
set -g default-terminal "${TERM}"

# Pane border styles
set -g pane-active-border-style 'fg=magenta,bg=default'
set -g pane-border-style 'fg=brightblack,bg=default'

# ==========================================
# KEY BINDINGS
# ==========================================
# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# ==========================================
# PLUGINS
# ==========================================
set -g @plugin 'tmux-plugins/tpm'                   # Tmux Plugin Manager
set -g @plugin 'tmux-plugins/tmux-sensible'         # Sensible defaults
set -g @plugin 'tmux-plugins/tmux-resurrect'        # Restore tmux environment after restart
set -g @plugin 'tmux-plugins/tmux-continuum'        # Continuous saving of tmux environment
set -g @plugin 'tmux-plugins/tmux-yank'             # Copy to system clipboard
set -g @plugin 'tmux-plugins/tmux-cpu'              # CPU usage
set -g @plugin 'tmux-plugins/tmux-battery'          # Battery status
set -g @plugin 'tmux-plugins/tmux-copycat'          # Enhanced search
set -g @plugin 'catppuccin/tmux#v2.1.3'             # Catppuccin theme
set -g @plugin 'omerxx/tmux-sessionx'               # Session manager
set -g @plugin 'sainnhe/tmux-fzf'                   # FZF integration
set -g @plugin 'wfxr/tmux-fzf-url'                  # Open URLs with FZF
set -g @plugin 'robhurring/tmux-uptime'             # Uptime status
set -g @plugin 'ofirgall/tmux-window-name'          # Smart window naming
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name' # Nerd font window names
set -g @plugin 'trevarj/tmux-open-nvim'             # Open files in nvim
set -g @plugin 'whame/tmux-modal'                   # Modal interface
set -g @plugin 'jaclu/tmux-mouse-swipe'             # Mouse swipe gestures
set -g @plugin 'jaclu/tmux-menus'                   # Menus

set -g @plugin 'kursataknc/tmux-ip-address'         # Show IP address in status bar (with local)
set -g @plugin 'kursataknc/tmux-net-speed'          # Show network speed in status bar (with macOS support)
set -g @plugin 'olimorris/tmux-pomodoro-plus'       # Pomodoro timer

set -g @net_speed_interfaces "en0"                # Network interface for speed
set -g @download_speed_format "%10s" # Format for download speed
set -g @upload_speed_format "%10s" # Format for upload speed
set -g @net_speed_format "D:%10s U:%10s" # Format for network speed

set-option -g @plugin 'b0o/tmux-autoreload'         # Auto reload config on change


# ==========================================
# PLUGIN CONFIGURATIONS
# ==========================================

# --- SessionX ---
set -g @sessionx-bind-zo-new-window 'ctrl-y'
set -g @sessionx-auto-accept 'off'
set -g @sessionx-custom-paths '/Users/kursataknc/dotfiles'
set -g @sessionx-bind 'o'
set -g @sessionx-x-path '~/dotfiles'
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-custom-paths-subdirectories 'false'
set -g @sessionx-filter-current 'false'

# --- Resurrect & Continuum ---
# set -g @continuum-restore 'on'
set -g @resurrect-strategy-nvim 'session'

# --- FZF URL ---
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

# --- Menus ---
set -g @menus_trigger 'Space'

# --- IP Address ---
set -g @ip_address_mode 'local'  # Show local IP address (Default is public)

# --- Treemux ---
set -g @treemux-tree-client 'nvim-tree'  # or 'neo-tree'
set -g @treemux-tree-nvim-init-file '~/.config/tmux/plugins/treemux/configs/treemux_init.lua'
set -g @plugin 'kiyoon/treemux'                     # File tree (order matters)

# Set python with pynvim installed.
# Use an absolute path because if you activate a python virtual environment, the pynvim may not be installed on that environment.
# set -g @treemux-python-command '/path/to/python3'  # default is '/usr/bin/python3'

# If you want to completely isolate the treemux's nvim config and data from your main nvim config and data, set NVIM_APPNAME.
# This will make treemux use '~/.config/nvim-treemux', '~/.local/share/nvim-treemux'
# set -g @treemux-nvim-command 'NVIM_APPNAME=nvim-treemux nvim'  # default is 'nvim'

# ==========================================
# THEME & STATUS BAR (Catppuccin)
# ==========================================
# Ensure the Catppuccin tmux module is loaded before we set status-left/status-right
if "test -f ~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux" \
   "run '~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux'"

set -g @catppuccin_flavor 'mocha'                 # latte, frappe, macchiato, mocha
set -g @catppuccin_window_status_style "rounded"  # window style: flat, rounded, or boxed
set -g @catppuccin_status_application_icon "true" # show application icon in status bar
set -g @catppuccin_status_session_icon "true"     # show session icon in status bar
set -g @catppuccin_status_cpu_icon "true"         # show cpu icon in status bar
set -g @catppuccin_status_battery_icon "true"     # show battery icon in status bar
set -g @catppuccin_status_uptime_icon "true"      # show uptime icon in status bar

set -g status-right-length 150                    # increase status bar length to fit more info
set -g status-left-length 150                     # increase status bar length to fit more info

set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " █"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W#{?window_zoomed_flag,(),}"
set -g @catppuccin_status_modules_right "directory" # date_time"
set -g @catppuccin_status_modules_left "session"
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator " "
set -g @catppuccin_status_right_separator_inverse "no"
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_directory_text "#{b:pane_current_path}"

# --- LEFT STATUS BAR ---   
set -g status-left ""                             # clear default left status
# set -g status-left "#{E:@catppuccin_status_application}" # application icon in status bar
set -ag status-left "#{E:@catppuccin_status_session}" # session name in status bar
set -ag status-left "#{pomodoro_status}"

# --- RIGHT STATUS BAR ---
set -g status-right ""                            # clear default right status
set -ag status-right '#(/opt/homebrew/bin/gitmux "#{pane_current_path}")' # git branch in status bar
set -agF status-right "#{E:@catppuccin_status_cpu}"     # cpu usage in status bar
set -agF status-right "#{E:@catppuccin_status_battery}" # battery status in status bar
set -ag status-right "#{E:@catppuccin_status_uptime}"   # uptime in status bar
set -ag status-right "#{ip_address}"                # public IP (tmux-ip-address plugin) in status bar
set -ag status-right "#{net_speed}"                 # network speed (tmux-net-speed plugin) in status bar


# ==========================================
# INITIALIZATION
# ==========================================
if "test ! -d ~/.config/tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm && ~/.config/tmux/plugins/tpm/bin/install_plugins'"

run '~/.config/tmux/plugins/tpm/tpm'